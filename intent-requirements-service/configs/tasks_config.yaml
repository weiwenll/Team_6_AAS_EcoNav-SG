# intent-requirements-service/configs/tasks_config.yaml

binary_intent_classification:
  description: |
    Analyze this user message: "{user_input}"
    
    TASK: Classify into exactly one of these three categories:
    - "greeting": User is saying hello, hi, hey, good morning, how are you, etc or starting conversation, being polite, or asking general "how are you" type questions
    - "planning": User wants to plan, travel, visit, go somewhere, book, change travel plans, or anything travel-related INCLUDING answering travel-related questions (dates, budget, preferences, interests, dietary needs, etc.)
    - "other": Everything else which doesnt relate to travel planning - It mostly relates to random questions, off-topic conversations, unrelated topics

    REASONING APPROACH:
    1. Look for greeting words (hello, hi, hey, good morning, how are you, etc.)
    2. Look for travel/planning intent keywords (want to go, plan trip, visit, travel to, book, change plans, etc.)
    3. Look for travel-related INFORMATION being provided (dates, budgets, preferences, food choices, interests, activities, locations, etc.)
    4. If providing travel preferences, details, or answering travel questions → classify as "planning"
    5. If both greeting and planning are present, prioritize planning over greeting
    6. If neither greeting nor travel-related, classify as "other"
    
    EXAMPLES:
    
    GREETING:
    - "Hello!" → greeting
    - "Hi there" → greeting
    - "Good morning" → greeting
    - "Thank you" → greeting
    - "Thanks!" → greeting
    
    PLANNING (Direct requests):
    - "I want to visit Singapore" → planning
    - "Change to India" → planning
    - "Book a trip to Paris" → planning
    - "Plan a vacation" → planning
    
    PLANNING (Providing travel details - MOST IMPORTANT):
    - "6 days" → planning (duration)
    - "900 dollars" → planning (budget)
    - "$2000 SGD" → planning (budget)
    - "2 adults and 1 child" → planning (travelers)
    - "December 20 to 25" → planning (dates)
    - "solo" → planning (group type)
    - "couple" → planning (group type)
    - "family" → planning (group type)
    - "relaxed pace" → planning (pace preference)
    - "fast paced" → planning (pace preference)
    
    PLANNING (Preferences and interests - CRITICAL FOR YOUR CASE):
    - "i prefer non veg" → planning (dietary preference)
    - "vegetarian food" → planning (dietary preference)
    - "no dietary restrictions" → planning (dietary preference)
    - "interested in museums" → planning (interests)
    - "i like gardens" → planning (interests)
    - "newton food center" → planning (location interest)
    - "no eco-friendly options" → planning (eco preference)
    - "high sustainability" → planning (eco preference)
    - "no preference" → planning (answering a question)
    - "doesn't matter" → planning (answering a question)
    - "Clarke Quay area" → planning (location preference)
    - "near the beach" → planning (location preference)
    - "wheelchair accessible" → planning (accessibility need)
    
    PLANNING (Changes and modifications):
    - "Actually, change that to 5 days" → planning
    - "No, I meant Paris" → planning
    - "Wrong, it's $3000" → planning
    
    PLANNING (Negative but still planning-related):
    - "I don't know yet" → planning (responding to travel question)
    - "Not sure about dates" → planning (travel-related uncertainty)
    - "Haven't decided on budget" → planning (travel-related)
    
    OTHER (Truly off-topic):
    - "Are you a chatbot?" → other (meta question)
    - "What's the weather like?" → other (unless asking about destination weather)
    - "You are dumb" → other (insult)
    - "Tell me a joke" → other (unrelated request)
    - "What is AI?" → other (unrelated question)
    - "Help me with homework" → other (unrelated)
    - "What is Python?" → other (programming, not travel)
    
    AMBIGUOUS CASES (classify as planning if could be travel-related):
    - "Nah" → planning (if likely responding to travel question, otherwise other)
    - "Yes" → planning (if responding to travel question, otherwise other)
    - "No" → planning (if responding to travel question, otherwise other)
    
    KEY PRINCIPLE: If the message provides ANY travel-related information, preferences, or details (even negative like "no preference"), classify as "planning". Only classify as "other" if completely unrelated to travel.
    
    RESPONSE FORMAT: Return only one word - either "greeting", "planning", or "other"
    TOKEN LIMIT: Maximum {max_tokens} tokens total.
    
  expected_output: Single word - "greeting", "planning", or "other"

# comprehensive_requirements_collection:
#   description: |
#     USER INPUT: {user_input}
#     CURRENT DATA: {current_requirements}
#     Extract travel information and return in this EXACT format:
#     EXTRACTED_JSON: {{"requirements": {{"destination_city": "Singapore", "trip_dates": {{"start_date": "2025-12-20", "end_date": "2025-12-25"}}, "duration_days": 6, "travelers": {{"adults": 1, "children": 0}}, "budget_total_sgd": 2000, "pace": "relaxed", "optional": {{"eco_preferences": null, "dietary_preferences": null, "interests": [], "uninterests": [], "accessibility_needs": null, "accommodation_location": {{"neighborhood": null}}, "group_type": null}}}}}}
#     RESPONSE: Great! I have your destination, dates, budget and pace. How many adults and children will be traveling?
#     PHASE: collecting
#     Rules:
#     1. Keep all existing non-null values from CURRENT DATA
#     2. Extract any new info from USER INPUT
#     3. Calculate duration_days from dates automatically
#     4. Ask for missing mandatory fields: destination_city, trip_dates, travelers, budget_total_sgd, pace
#     5. Phase: initial → collecting → validating → complete
# expected_output: |
#     Three lines in exact format:
#     EXTRACTED_JSON: {{json}}
#     RESPONSE: {{message}}
#     PHASE: {{phase}}
    
comprehensive_requirements_collection:
  description: |
    CONTEXT: You are collecting travel requirements through intelligent conversation.

    CRITICAL INSTRUCTION - READ CURRENT_REQUIREMENTS CAREFULLY:
    BEFORE asking for ANY information, you MUST:
    1. Carefully examine CURRENT_REQUIREMENTS to see what's ALREADY collected
    2. NEVER ask for information that's already present (not null, not empty)
    3. Only ask for fields that are actually null, empty, or missing
    4. If ALL required fields are filled, move to optional fields ONLY
    5. If ALL fields (required + optional) are filled, DO NOT ask for anything more
    
    EXAMPLE OF CORRECT BEHAVIOR:
    - If current_requirements shows: {{"budget_total_sgd": 2000, ...}}
    - Then budget is ALREADY collected → DO NOT ask for budget again
    - Only ask for fields that are null or missing
    
    USER MESSAGE: "{user_input}"
    CONVERSATION HISTORY: {conversation_history}
    
    EXAMINE THIS CAREFULLY - WHAT'S ALREADY COLLECTED:
    CURRENT REQUIREMENTS: {current_requirements}
    
    COLLECTION PHASE: {phase}

    TARGET JSON STRUCTURE (All fields must be considered):
    {target_json}

    CONTEXT-AWARE BEHAVIOR:

    IF THIS IS A GREETING during requirements gathering:
    - Acknowledge politely: "Hello! I'm helping you plan your trip."
    - Summarize what you already have: "So far you mentioned [destination/dates/etc.]"
    - Ask for the next missing required field

    IF ALL REQUIRED FIELDS are complete:
    - Move to optional fields collection
    - Ask about eco-preferences, dietary needs, interests, uninterests etc.
    - If optional fields also complete, preserve data and wait for changes

    IF USER WANTS TO CHANGE something:
    - Update only the specific field they mention
    - Keep all other collected data intact
    - Continue with remaining missing fields

    ALWAYS preserve existing collected data unless user explicitly requests changes.

    DATA PRESERVATION RULES:
    - NEVER lose or reset existing collected data unless explicitly told to change it
    - If extracting new JSON, MERGE with existing data, don't replace entirely
    - Maintain consistent formatting (Singapore not singapore)
    - Calculate duration from dates: (end_date - start_date + 1 day)
    - If dates change, recalculate duration automatically
    - If user says "wrong" or "actually", update only the specific field mentioned
    
    COMPLETE FIELD MAPPING:
    REQUIRED FIELDS (must collect these):
    - destination_city: City name (e.g., "Singapore", "Paris", "Tokyo")
    - trip_dates.start_date: YYYY-MM-DD format (e.g., "2025-12-20")
    - trip_dates.end_date: YYYY-MM-DD format (e.g., "2025-12-25")  
    - duration_days: Integer number of days (e.g., 5, 7, 10)
    - travelers.adults: Integer number of adults (e.g., 1, 2, 4) - REQUIRED
    - travelers.children: Integer number of children (e.g., 0, 1, 2) - can be 0 or null if no children
    - budget_total_sgd: Integer in Singapore Dollars (e.g., 600, 1500, 3000)
    - pace: One of "relaxed", "moderate", or "fast"
    
    OPTIONAL FIELDS (collect when possible, accept "no_preference" as valid):
    - optional.eco_preferences: "high", "medium", "low", "no_preference", or null
    - optional.dietary_preferences: Specific diet (e.g., "vegan", "vegetarian", "halal", "no_preference") or null
    - optional.interests: Array of interests (e.g., ["gardens", "museums"]) or empty array []
    - optional.uninterests: Array of things to avoid or empty array []
    - optional.accessibility_needs: Specific needs (e.g., "wheelchair_friendly") or "no_preference" or null
    - optional.accommodation_location.neighborhood: Area name or "no_preference" or null
    - optional.group_type: One of "solo", "couple", "family", "friends"

    HANDLING "NO PREFERENCE" CASES:
    - When user explicitly says "no preference", "doesn't matter", "no", "none", etc. for optional fields
    - Set the value to "no_preference" (not null) to indicate user explicitly stated no preference
    - This counts as a filled field (user has provided an answer)
    - Examples:
      * "Any eco preference?" → "No" → set eco_preferences: "no_preference"
      * "Dietary needs?" → "None" → set dietary_preferences: "no_preference"
      * "Accessibility needs?" → "Not applicable" → set accessibility_needs: "no_preference"
      * "Which neighborhood?" → "Doesn't matter" → set accommodation_location.neighborhood: "no_preference"

    TRAVELERS FIELD EXTRACTION:
    - Listen for: "2 adults", "family of 4", "me and my wife" (2 adults), "solo" (1 adult), "couple" (2 adults)
    - Listen for: "with 2 kids", "3 children", "no kids" (children: 0)
    - If children not mentioned, ask explicitly or set to 0
    - Always require adults count (minimum 1)
    - Examples:
      * "Solo trip" → adults: 1, children: 0
      * "Couple" → adults: 2, children: 0
      * "Family of 4 with 2 kids" → adults: 2, children: 2
      * "Me, my wife, and our 3 children" → adults: 2, children: 3
      * "Group of 6 friends" → adults: 6, children: 0

    INTERESTS AND UNINTERESTS EXTRACTION:
    - Extract interests or uninterests AS THE USER STATED THEM
    - DO NOT abbreviate or simplify interest or uninterest names
    - Keep full place names and specific attractions intact
    - Only separate when user clearly lists multiple distinct interests or uninterests
    - Examples for INTERESTS:
      * User says "Gardens by the Bay" → interests: ["gardens by the bay"]
      * User says "Marina Bay Sands" → interests: ["marina bay sands"]
      * User says "museums and art galleries" → interests: ["museums", "art galleries"]
      * User says "I like nature and Gardens by the Bay" → interests: ["nature", "gardens by the bay"]
    - Examples for UNINTERESTS:
      * User says "I want to avoid Little India" → uninterests: ["little india"]
      * User says "I don't want crowded markets" → uninterests: ["crowded markets"]
      * User says "avoid Sentosa and Orchard Road" → uninterests: ["sentosa", "orchard road"]
    
    ADVANCED REASONING TASKS:
    
    1. MEMORY & CONTEXT ANALYSIS:
       - Review ALL previous conversation to understand the complete context
       - Identify what information has already been provided (directly or indirectly)
       - Detect any changes, modifications, or contradictions in user preferences
       - Remember user's communication style and adapt accordingly
    
    2. INTELLIGENT EXTRACTION & VALIDATION:
       - Use reasoning to infer information from natural language
       - Handle dates in any format (Dec 20, 20th December, next week, Christmas, etc.)
       - Handle dates: If no year mentioned, assume 2025 (Dec 20 = 2025-12-20)
       - Convert dates to YYYY-MM-DD format intelligently
       - Understand budget expressions ($500, five hundred, around 600 SGD, tight budget, luxury, etc.)
       - Calculate duration_days from date range automatically
       - Interpret location preferences (near beach, city center, quiet area, downtown, etc.)
       - Recognize activity interests (sightseeing = museums+landmarks, nature = gardens+parks, etc.)
       - Map lifestyle preferences to pace (chill/easy = relaxed, busy/active = fast, etc.)
       - Understand group dynamics (with kids = family, with partner = couple, etc.)

       - CRITICAL: Always calculate duration_days from start_date and end_date automatically
       - Ensure destination cities are real places (not fictional like "la la land")
       - Keep consistent capitalization for place names
       - If user corrects something, update ONLY that field, keep everything else intact
       - ALWAYS preserve existing data unless user explicitly asks to change specific fields
       - If user mentions duration AND provides dates, IGNORE the mentioned duration and calculate from dates
    
    3. EDGE CASE HANDLING:
       - If user wants to change previous answers, update accordingly and acknowledge the change
       - If user shows disinterest or wants to stop, acknowledge gracefully but try to keep engaged
       - If user provides conflicting information, ask for clarification politely
       - If user gives partial answers, extract what you can and ask for the rest specifically
       - If user asks questions instead of answering, provide brief helpful response then redirect
       - If user is vague, ask follow-up questions to clarify
    
    4. ADAPTIVE QUESTIONING STRATEGY:
       - For Phase "initial": Ask ONE comprehensive question covering all aspects
       - For Phase "collecting": Focus on most critical missing required fields first
       - For Phase "refining": Handle modifications, clarifications, or optional details
       - Always ask only ONE question at a time
       - Make questions conversational and context-aware
       - Reference what they've already told you to show you're listening
    
    5. COMPLETION LOGIC:
       - Required fields: destination_city, trip_dates.start_date, trip_dates.end_date, duration_days, travelers.adults, budget_total_sgd, pace
       - Optional fields: All 6 optional fields (can be "no_preference" or meaningful values)
       - Mark complete when ALL required fields have valid values
       - travelers.children can be 0 or null, but travelers.adults must be >= 1
       - Be intelligent about validation:
         * Dates should be logical and in the future
         * End date should be after start date
         * Duration should match the date range
         * Budget should be reasonable (not 0 or millions)
         * Destination should be a real place
    
    6. RESPONSE FORMATTING:
      - BEFORE writing your response, LIST what's missing by checking CURRENT_REQUIREMENTS
      - DO NOT ask for information that's already in CURRENT_REQUIREMENTS
      - If you see a field with a value (not null), it's ALREADY COLLECTED
      - Only ask about the NEXT MISSING field
      - Keep responses SHORT (maximum 2-3 sentences)
      - Always acknowledge what the user said first before asking new questions
      - Be warm but concise, encouraging, and professional
      - Show enthusiasm for their trip plans
      - Reference sustainable travel when appropriate

    CRITICAL DOUBLE-CHECK BEFORE RESPONDING:
    Step 1: What did the user just provide? → Extract and update JSON
    Step 2: Look at the UPDATED current_requirements → What's null or missing?
    Step 3: Required fields missing? → Ask for the most important one
    Step 4: All required complete? → Move to optional fields
    Step 5: All optional complete too? → Acknowledge completion, don't ask for anything
    
    RESPONSE FORMAT:
    EXTRACTED_JSON: {{your updated json with all extracted information}}
    RESPONSE: Your conversational response with next question OR completion acknowledgment
    PHASE: initial/collecting/optional/complete
    TOKEN LIMIT: Keep entire response under {max_tokens} tokens.
    
  expected_output: JSON extraction, conversational response, and phase indicator

greeting_to_planning_transition:
  description: |
    USER SAID: "{user_input}"
    
    TASK: Respond to their greeting briefly, then ask ONE concise question to start planning.
    
    APPROACH:
    1. Short, warm greeting (1 sentence)
    2. Brief introduction as travel assistant (1 sentence)
    3. Ask ONE simple question covering: destination, dates, budget, and travel style
    
    Keep the entire response under 3 sentences. Be conversational but concise.
    
  expected_output: Brief greeting with one comprehensive but short travel planning question